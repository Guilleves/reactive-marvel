    <!doctype html>
    <html lang="en">
    <head>
        <script src="https://unpkg.com/react@15.3.0/dist/react.js"></script>
        <script src="https://unpkg.com/react-dom@15.3.0/dist/react-dom.js"></script>
        <script src="https://unpkg.com/babel-standalone@6.15.0/babel.min.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/react-bootstrap/0.30.5/react-bootstrap.js"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/latest/css/bootstrap.min.css">
        <link rel="stylesheet" href="base.css" />

        <meta charset="UTF-8">
        <title>Document</title>

    </head>
    <body>
        <div id="navbar" >

        </div>
        <div id="main">
        </div>

        <script type="text/babel">

        function hitAPI (query,fn){
            let xhr = new XMLHttpRequest();
            console.log(query);
            xhr.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    var chars = JSON.parse(this.responseText);
                    return fn(chars)
                //chars["data"]["results"]
                }
            };
            xhr.open("GET", "http://gateway.marvel.com:80/v1/public/characters?ts=1&nameStartsWith=" + query + "&limit=100&apikey=c853e32a3cdaa00bfb344c5bd47c1230&hash=ad8228ded3fe3fd80db2d703b88f1397");
            xhr.send();
        };

        function onSelectCharacters(eventKey){
            ReactDOM.render(<CharacterList />, document.getElementById("main"));
        };
        function onSelectComics(eventKey){
            ReactDOM.render(<ComicList />, document.getElementById("main"));
        };
        function onSelectMain(eventKey){
            ReactDOM.render(navbarInstance, document.getElementById("navbar"));
            ReactDOM.render(carouselInstance, document.getElementById("main"));
        };
        function onSelectWishlist(eventKey){
            ReactDOM.render(<Wishlist/>, document.getElementById("main"));
        };
    //original: &apikey=039eb48267ed197802f5e77e78d0f3f5&hash=e90ab34566660a82686c9d188a356fbd
    /////////////////////////////////////////////////
    var Navbar = ReactBootstrap.Navbar,
    Nav = ReactBootstrap.Nav,
    NavItem = ReactBootstrap.NavItem,
    DropdownButton = ReactBootstrap.DropdownButton,
    MenuItem = ReactBootstrap.MenuItem,
    NavDropdown = ReactBootstrap.NavDropdown,
    Grid = ReactBootstrap.Grid,
    Row = ReactBootstrap.Row,
    Col = ReactBootstrap.Col,
    Thumbnail = ReactBootstrap.Thumbnail,
    Button = ReactBootstrap.Button,
    Modal = ReactBootstrap.Modal,
    Carousel = ReactBootstrap.Carousel,
    Panel = ReactBootstrap.Panel,
    Accordion = ReactBootstrap.Accordion;

    const navbarInstance = (
        <Navbar inverse>
        <Navbar.Header>

          <Navbar.Toggle />
        </Navbar.Header>
        <Navbar.Collapse>
          <Nav>
            <NavItem eventKey={0} onSelect={onSelectMain} href="#">Marvel Catalogue</NavItem>
            <NavItem eventKey={1} onSelect={onSelectCharacters} href="#">Characters</NavItem>
            <NavItem eventKey={2} onSelect={onSelectComics} href="#">Comics</NavItem>
            <NavDropdown eventKey={3} title="Dropdown" id="basic-nav-dropdown">
              <MenuItem eventKey={3.1}>Action</MenuItem>
              <MenuItem eventKey={3.2}>Another action</MenuItem>
              <MenuItem eventKey={3.3}>Something else here</MenuItem>
              <MenuItem divider />
              <MenuItem eventKey={3.3}>Separated link</MenuItem>
            </NavDropdown>
          </Nav>
          <Nav pullRight>
            <NavItem eventKey={1} onSelect={onSelectWishlist} href="#">Wishlist</NavItem>
            <NavItem eventKey={2} href="#">Link Right</NavItem>
          </Nav>
        </Navbar.Collapse>
        </Navbar>
        );

        const carouselInstance = (
          <Carousel>
            <Carousel.Item>
              <img width={1280} height={720} alt="1280x500" src="/assets/logo.jpg"/>
            </Carousel.Item>
            <Carousel.Item>
              <img width={1280} height={720} alt="900x500" src="/assets/avengers.jpg"/>
              <Carousel.Caption>
                <h3>Characters</h3>
                <p>Search characters by name</p>
              </Carousel.Caption>
            </Carousel.Item>
            <Carousel.Item>
              <img width={1280} height={720} alt="900x500" src="/assets/series.jpg"/>
              <Carousel.Caption>
                <h3>Comics</h3>
                <p>Search comics by name</p>
              </Carousel.Caption>
            </Carousel.Item>
          </Carousel>
        );

        let CharacterList = React.createClass({
            getInitialState: function() {
                return({ characters: [],
                         filterText: "",
                         view: "",
                         charId: "",
                         characterComics: []})
            },
            handleSearchBar: function(text){
                this.setState({ filterText: text});
                hitAPI(text, function(chars){
                    let charsArray = chars["data"]["results"];
                    this.setState({ characters: charsArray });
                }.bind(this))
            },
            handleEnterDetailedView: function(e) {
                this.setState({view: "detail",
                               charId: e.target.value});
            },
            // getComicsFromApi: function(query, fn) {
            //     let xhr = new XMLHttpRequest();
            //     console.log(query);
            //     xhr.onreadystatechange = function() {
            //         if (this.readyState == 4 && this.status == 200) {
            //             var chars = JSON.parse(this.responseText);
            //             return fn(chars)
            //         }
            //     };
            //     xhr.open("GET", "http://gateway.marvel.com:80/v1/public/characters/" + query + "/comics?ts=1&limit=100&apikey=c853e32a3cdaa00bfb344c5bd47c1230&hash=ad8228ded3fe3fd80db2d703b88f1397");
            //     xhr.send();
            // },
            renderDetail: function() {
                let charId = this.state.charId;
                console.log(this.state.characterComics);
                let char = this.state.characters.find(function(character) {
                    return character.id == charId;
                });
                console.log(char);
                return(
                    <div><CharacterDetail key={ char.id } id={ char.id } name={ char.name } description={ char.description } picture={ char.thumbnail.path } comics={ this.state.characterComics } stories={ char.stories.items } events={ char.events.items } series={ char.series.items }/></div>
                )
            },
            renderList: function(){
                let characterRows = this.state.characters.map((char) => {
                    return(<div><Col xs={6} md={4}>
                    <Thumbnail className="thumb" src={ char.thumbnail.path+".jpg" } width="200" height="200">
                    <h3>{ char.name }</h3>
                    <p>
                        <Button bsStyle="primary" onClick={this.handleEnterDetailedView} value={ char.id }>View</Button>
                    </p>
                    </Thumbnail>
                    </Col></div>)
                });
                return(<div>
                     Look for a character by name: <SearchBar onUserInput={this.handleSearchBar} filterText={this.state.filterText}/>
                    <Grid>
                    <Row>
                    { characterRows }
                    </Row>
                    </Grid>
                    </div>)
            },
            render: function(){
                if (this.state.view === "detail")
                    return this.renderDetail();
                else
                    return this.renderList();
            }
        });

        let CharacterDetail = React.createClass({
            getInitialState() {
              return ({ showModal: false,
                        characterComics: []});
            },
            close() {
              this.setState({ showModal: false });
            },
            open() {
              this.setState({ showModal: true });
            },
            getComicsFromApi: function(query, fn) {
                let xhr = new XMLHttpRequest();
                console.log(query);
                xhr.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        var chars = JSON.parse(this.responseText);
                        return fn(chars)
                    }
                };
                xhr.open("GET", "http://gateway.marvel.com:80/v1/public/characters/" + query + "/comics?ts=1&limit=100&apikey=c853e32a3cdaa00bfb344c5bd47c1230&hash=ad8228ded3fe3fd80db2d703b88f1397");
                xhr.send();
            },
            componentDidMount: function() {
                let charId = this.props.id;
                this.getComicsFromApi(charId, function(coms){
                    let comsArray = coms["data"]["results"];
                    this.setState({ characterComics: comsArray });
                }.bind(this));
            },
            render: function(){
                let comics = this.props.comics.map(comic => {
                    return (<div>
                        <p>{ comic.title }</p>
                        <Button bsStyle="primary" bsSize="large" onClick={this.open} value={ comic.id }>View</Button>
                        <Modal show={this.state.showModal} onHide={this.close}>
                          <Modal.Header closeButton>
                            <Modal.Title>{comic.title}</Modal.Title>
                          </Modal.Header>
                          <Modal.Body>
                              <h4>About</h4>
                              <img src={ comic.thumbnail.path+".jpg"} width="200" height="300"/>
                              <p>{ comic.description }</p>
                              <p>Price: { comic.prices.price }</p>
                              <span>Page count: { comic.pageCout }</span>
                            <hr />
                          </Modal.Body>
                          <Modal.Footer>
                            <Button onClick={this.close}>Close</Button>
                          </Modal.Footer>
                        </Modal>
                        </div>
                    )
                })
                return(
                    <div>
                        <h3>{ this.props.name }</h3>
                        <img src={ this.props.picture+".jpg"} width="300" height="300"/>
                        <p>{ this.props.description }</p>
                        <p>{ comics }</p>
                    </div>
                )
            }
        });

        let SearchBar = React.createClass({
            getInitialState: function() {
                return({ content: "" });
            },
            handleInput: function(e){
                this.props.onUserInput(e.target.value);
            },
            render: function() {
                return(<div><input type="text" value={this.props.filterText} onChange={this.handleInput} /></div>)
            }
        });

    ///////////////////////////////////////// COMIC LIST

        let ComicList = React.createClass({
            getInitialState: function(){
                return({ comics: [],
                         filterText: "",
                         comicId: "",
                         view: "",
                         cart: JSON.parse(localStorage.getItem('cart'))});
            },
            handleSearchBar: function(text) {
                this.setState({filterText: text});
                this.apiCall(text, function(coms){
                    let comsArray = coms["data"]["results"];
                    this.setState({ comics: comsArray });
                }.bind(this))
            },
            handleEnterDetailedView: function(e) {
                this.setState({view: "detail",
                               comicId: e.target.value,
                               comicName: e.target.name})
            },
            addComicToCart: function(e) {
                console.log("ls", JSON.parse(localStorage.getItem('cart')));
                this.setState({cart: JSON.parse(localStorage.getItem('cart'))});
                console.log("estado", this.state.cart);
                let comicId = e.target.value;
                let comic = this.state.comics.find(comic => {
                    return comic.id == comicId});
                let cart = this.state.cart;
                console.log("comic", comic);
                if (this.state.cart == null){
                    cart = [];
                    //cart.push(<li><ComicRow key={ comic.id } name={ comic.name } picture={ comic.picture }/></li>);
                    cart.push(comic);
                }
                else {
                    cart.push(comic);
                };
                console.log("cart final", cart);
                localStorage.removeItem('cart');
                localStorage.setItem('cart', JSON.stringify(cart));
            },
            renderDetail: function() {
                let comicId = this.state.comicId;
                console.log(this.state.comics);
                console.log(comicId);
                let comic = this.state.comics.find(function(comic) {
                    return comic.id == comicId;
                });
                console.log(comic);
                return(
                    <div><ComicDetail key={ comic.id } id={ comic.id } title={ comic.title } description={ comic.description } picture={ comic.thumbnail.path } chars={ comic.characters.items } stories={ comic.stories.items } events={ comic.events.items } series={ comic.series.items } pages={comic.pageCount} price={ comic.prices.price } /></div>
                )
            },
            render: function() {
                let comicRows = this.state.comics.map((comic) => {
                    return (
                        <div className="thumb"><Col xs={6} md={4}>
                        <Thumbnail src={ comic.thumbnail.path+".jpg" } alt="242x200">
                        <h3>{ comic.title }</h3>
                        <p>
                            <Button bsStyle="primary" value={ comic.id } onClick={ this.handleEnterDetailedView }>View</Button>
                            <button type="button" className="btn" value={ comic.id } name={comic.name} onClick={ this.addComicToCart }>Add to cart</button>
                        </p>
                        </Thumbnail>
                        </Col></div>)});
    //<li><ComicRow key={ comic.id } name={ comic.title } description={ comic.description } picture={ comic.thumbnail.path }/></li>)
                if (this.state.view == "detail")
                    return this.renderDetail();
                else
                    return(
                        <div>
                        <Grid>
                        <Row>
                        { comicRows }
                        </Row>
                        </Grid>
                        <p>Look for a comic by name: <SearchBar className="form-control input-lg" onUserInput={this.handleSearchBar} filterText={this.state.filterText}/></p>
                        </div>
                    )
            },
            apiCall: function(query, fn) {
                let xhr = new XMLHttpRequest();
                console.log(query);
                xhr.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        var chars = JSON.parse(this.responseText);
                        return fn(chars)
                    }
                };
                xhr.open("GET", "http://gateway.marvel.com:80/v1/public/comics?ts=1&titleStartsWith=" + query + "&limit=100&apikey=c853e32a3cdaa00bfb344c5bd47c1230&hash=ad8228ded3fe3fd80db2d703b88f1397");
                xhr.send();
            }
        });

        let ComicRow = React.createClass({
            render: function(){
                return( <div>
                            <p>Comic: { this.props.name }</p>
                            <img src={ this.props.picture+".jpg"} width="200" height="300"/>
                        </div>)
            }
        });

        let ComicDetail = React.createClass({
            render: function(){
                return(
                    <div>
                    <Grid>
                        <Row className="show-grid">
                        <Col xs={6} md={4}>
                            <h3>{this.props.title}</h3>
                            <p>{this.props.description}</p>
                            <span>{this.props.chars}</span>
                            <li>Price: {this.props.price}</li>
                            <li>Number of pages: {this.props.pages}</li>
                        </Col>
                          <Col xs={12} md={8}><img src={this.props.picture+".jpg"}/></Col>
                        </Row>
                    </Grid>
                    </div>
                )
            }
        });
        //////////////////////////////////////////// WISHLIST
        let Wishlist = React.createClass({
            getInitialState: function() {
                return({list:[],
                        ls: JSON.parse(localStorage.getItem('cart'))})
            },
            render: function() {
                let wishlist = this.state.ls.map(comic => {
                    return(
                        <div>
                        <Accordion>
                        <Panel header={comic.title} bsStyle="primary" eventKey="1   ">
                            <p><img src={comic.thumbnail.path+".jpg"} width="200" height="300"/></p>
                            <span>Price: {comic.prices[0].price}</span>
                        </Panel>
                        </Accordion>
                        </div>
                    );
                })
                return (
                    <div>
                    {wishlist}
                    </div>
                )
            }
        });

        //ReactDOM.render(<CharacterList />, document.getElementById("main"));
        //ReactDOM.render(<ComicList />, document.getElementById("comics"));
        ReactDOM.render(navbarInstance, document.getElementById("navbar"));
        ReactDOM.render(carouselInstance, document.getElementById("main"));

        </script>
    </html>
    </body>
